/**
 * Theme Presets Storybook Story
 * 
 * Visualizes all official theme presets with mode comparisons
 */

import type { Meta, StoryObj } from '@storybook/react';
import { useState } from 'react';
import { UIProvider } from '../core/context/UIProvider';
import { themePresetRegistry } from '../core/theme/registry';
import '../core/theme/presets'; // Auto-register presets

/**
 * Theme Preset Viewer Component (uses preset tokens directly, not from provider)
 */
function ThemePresetViewerContent() {
  const allPresets = themePresetRegistry.getAll();
  const [selectedPresetId, setSelectedPresetId] = useState(allPresets[0]?.id || 'marketing-page-mui');
  const [selectedMode, setSelectedMode] = useState<'light' | 'dark'>('light');
  
  const selectedPreset = themePresetRegistry.get(selectedPresetId);

  // Check if there are any themes
  if (allPresets.length === 0) {
    return (
      <div style={{ padding: '40px', textAlign: 'center' }}>
        <p>No theme presets registered. Please register theme presets first.</p>
      </div>
    );
  }

  if (!selectedPreset) {
    return <div>Theme preset not found</div>;
  }

  // Use the preset's tokens directly (flat structure)
  const { colors, typography, spacing, radius, shadows } = selectedPreset;
  
  // Helper to convert spacing number to rem/px
  const sp = (key: keyof typeof spacing) => `${spacing[key]}px`;
  
  // Helper for typography values
  const fontSize = {
    xs: '0.75rem',
    sm: '0.875rem',
    base: '1rem',
    lg: '1.125rem',
    xl: '1.25rem',
    '2xl': '1.5rem',
    '3xl': '1.875rem',
  };
  const fontWeight = {
    normal: 400,
    medium: 500,
    semibold: 600,
    bold: 700,
  };

  return (
    <div style={{ 
      padding: sp('xl'),
      backgroundColor: colors.background,
      minHeight: '100vh',
    }}>
      {/* Header */}
      <div style={{ marginBottom: sp('2xl') }}>
        <h1 style={{ 
          fontSize: fontSize['3xl'],
          fontWeight: fontWeight.bold,
          marginBottom: sp('md'),
          color: colors.textPrimary,
        }}>
          Theme Presets
        </h1>
        <p style={{ 
          fontSize: fontSize.lg,
          color: colors.textSecondary,
        }}>
          Official built-in themes with mode support
        </p>
      </div>

      {/* Theme Selector */}
      <div style={{ 
        marginBottom: sp('xl'),
        padding: sp('lg'),
        backgroundColor: colors.surface,
        borderRadius: `${radius.lg}px`,
        boxShadow: shadows.sm,
      }}>
        <label style={{ 
          display: 'block',
          fontSize: fontSize.sm,
          fontWeight: fontWeight.medium,
          marginBottom: sp('sm'),
          color: colors.textSecondary,
        }}>
          Select Theme Preset
        </label>
        <select
          value={selectedPresetId}
          onChange={(e) => {
            setSelectedPresetId(e.target.value);
            setSelectedMode('light');
          }}
          style={{ 
            width: '100%',
            padding: sp('md'),
            fontSize: fontSize.base,
            borderRadius: `${radius.md}px`,
            border: `1px solid ${colors.border}`,
            backgroundColor: tokens.colors.background.primary,
            color: tokens.colors.text.primary,
          }}
        >
          {allPresets.map((preset) => (
            <option key={preset.id} value={preset.id}>
              {preset.name}
            </option>
          ))}
        </select>

        {/* Mode Selector */}
        <div style={{ marginTop: tokens.spacing.lg }}>
            <label style={{ 
              display: 'block',
              fontSize: tokens.typography.fontSize.sm,
              fontWeight: tokens.typography.fontWeight.medium,
              marginBottom: tokens.spacing.sm,
              color: tokens.colors.text.secondary,
            }}>
              Theme Mode
            </label>
            <div style={{ display: 'flex', gap: tokens.spacing.sm }}>
              {(['light', 'dark'] as const).map((mode) => (
                <button
                  key={mode}
                  onClick={() => setSelectedMode(mode)}
                  style={{
                    padding: `${tokens.spacing.sm} ${tokens.spacing.md}`,
                    fontSize: tokens.typography.fontSize.sm,
                    borderRadius: tokens.radius.md,
                    border: selectedMode === mode 
                      ? `2px solid ${tokens.colors.brand.primary}`
                      : `1px solid ${tokens.colors.border.default}`,
                    backgroundColor: selectedMode === mode
                      ? tokens.colors.brand.primary
                      : tokens.colors.background.primary,
                    color: selectedMode === mode
                      ? tokens.colors.text.inverse
                      : tokens.colors.text.primary,
                    cursor: 'pointer',
                    fontWeight: selectedMode === mode 
                      ? tokens.typography.fontWeight.semibold 
                      : tokens.typography.fontWeight.normal,
                    textTransform: 'capitalize',
                  }}
                >
                  {mode}
                </button>
              ))}
            </div>
          </div>
      </div>

      {/* Theme Metadata */}
      <div style={{ 
        marginBottom: tokens.spacing.xl,
        padding: tokens.spacing.lg,
        backgroundColor: tokens.colors.background.secondary,
        borderRadius: tokens.radius.lg,
        boxShadow: tokens.shadows.sm,
      }}>
        <h2 style={{ 
          fontSize: tokens.typography.fontSize.xl,
          fontWeight: tokens.typography.fontWeight.semibold,
          marginBottom: tokens.spacing.md,
          color: tokens.colors.text.primary,
        }}>
          Theme Metadata
        </h2>
        <dl style={{ 
          display: 'grid',
          gridTemplateColumns: 'auto 1fr',
          gap: tokens.spacing.md,
          fontSize: tokens.typography.fontSize.sm,
        }}>
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            ID:
          </dt>
          <dd style={{ color: tokens.colors.text.primary, fontFamily: tokens.typography.fontFamily.mono }}>
            {selectedPreset.id}
          </dd>
          
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            Name:
          </dt>
          <dd style={{ color: tokens.colors.text.primary }}>
            {selectedPreset.name}
          </dd>
          
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            Description:
          </dt>
          <dd style={{ color: tokens.colors.text.primary }}>
            {selectedPreset.description}
          </dd>
          
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            Version:
          </dt>
          <dd style={{ color: tokens.colors.text.primary }}>
            {selectedPreset.version}
          </dd>
          
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            Mode:
          </dt>
          <dd style={{ color: tokens.colors.text.primary }}>
            {selectedPreset.mode}
          </dd>
          
          <dt style={{ fontWeight: tokens.typography.fontWeight.medium, color: tokens.colors.text.secondary }}>
            Active Mode:
          </dt>
          <dd style={{ color: tokens.colors.text.primary }}>
            {selectedMode}
          </dd>
        </dl>
      </div>

      {/* Color Palette Preview */}
      <div style={{ 
        marginBottom: tokens.spacing.xl,
      }}>
        <h2 style={{ 
          fontSize: tokens.typography.fontSize.xl,
          fontWeight: tokens.typography.fontWeight.semibold,
          marginBottom: tokens.spacing.lg,
          color: tokens.colors.text.primary,
        }}>
          Color Palette
        </h2>
        
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: tokens.spacing.md }}>
          {/* Brand Colors */}
          <ColorSwatch label="Brand Primary" color={tokens.colors.brand.primary} />
          <ColorSwatch label="Brand Secondary" color={tokens.colors.brand.secondary} />
          <ColorSwatch label="Brand Accent" color={tokens.colors.brand.accent} />
          
          {/* Background Colors */}
          <ColorSwatch label="BG Primary" color={tokens.colors.background.primary} />
          <ColorSwatch label="BG Secondary" color={tokens.colors.background.secondary} />
          <ColorSwatch label="BG Tertiary" color={tokens.colors.background.tertiary} />
          
          {/* Text Colors */}
          <ColorSwatch label="Text Primary" color={tokens.colors.text.primary} />
          <ColorSwatch label="Text Secondary" color={tokens.colors.text.secondary} />
          
          {/* State Colors */}
          <ColorSwatch label="Error" color={tokens.colors.state.error} />
          <ColorSwatch label="Warning" color={tokens.colors.state.warning} />
          <ColorSwatch label="Success" color={tokens.colors.state.success} />
          <ColorSwatch label="Info" color={tokens.colors.state.info} />
        </div>
      </div>

      {/* Component Preview */}
      <div style={{ 
        padding: tokens.spacing.lg,
        backgroundColor: tokens.colors.background.secondary,
        borderRadius: tokens.radius.lg,
        boxShadow: tokens.shadows.sm,
      }}>
        <h2 style={{ 
          fontSize: tokens.typography.fontSize.xl,
          fontWeight: tokens.typography.fontWeight.semibold,
          marginBottom: tokens.spacing.lg,
          color: tokens.colors.text.primary,
        }}>
          Component Preview
        </h2>
        
        {/* Sample Components */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: tokens.spacing.lg }}>
          {/* Buttons */}
          <div>
            <h3 style={{ 
              fontSize: tokens.typography.fontSize.md,
              fontWeight: tokens.typography.fontWeight.medium,
              marginBottom: tokens.spacing.md,
              color: tokens.colors.text.secondary,
            }}>
              Buttons
            </h3>
            <div style={{ display: 'flex', gap: tokens.spacing.md, flexWrap: 'wrap' }}>
              <button style={{
                padding: `${tokens.spacing.sm} ${tokens.spacing.lg}`,
                backgroundColor: tokens.colors.brand.primary,
                color: tokens.colors.text.inverse,
                border: 'none',
                borderRadius: tokens.radius.md,
                fontSize: tokens.typography.fontSize.base,
                fontWeight: tokens.typography.fontWeight.medium,
                cursor: 'pointer',
                boxShadow: tokens.shadows.sm,
              }}>
                Primary Button
              </button>
              <button style={{
                padding: `${tokens.spacing.sm} ${tokens.spacing.lg}`,
                backgroundColor: 'transparent',
                color: tokens.colors.brand.primary,
                border: `2px solid ${tokens.colors.brand.primary}`,
                borderRadius: tokens.radius.md,
                fontSize: tokens.typography.fontSize.base,
                fontWeight: tokens.typography.fontWeight.medium,
                cursor: 'pointer',
              }}>
                Secondary Button
              </button>
            </div>
          </div>

          {/* Cards */}
          <div>
            <h3 style={{ 
              fontSize: tokens.typography.fontSize.md,
              fontWeight: tokens.typography.fontWeight.medium,
              marginBottom: tokens.spacing.md,
              color: tokens.colors.text.secondary,
            }}>
              Cards
            </h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: tokens.spacing.md }}>
              {['Error', 'Warning', 'Success', 'Info'].map((state) => {
                const stateKey = state.toLowerCase() as 'error' | 'warning' | 'success' | 'info';
                return (
                  <div
                    key={state}
                    style={{
                      padding: tokens.spacing.lg,
                      backgroundColor: tokens.colors.background.primary,
                      borderLeft: `4px solid ${tokens.colors.state[stateKey]}`,
                      borderRadius: tokens.radius.md,
                      boxShadow: tokens.shadows.md,
                    }}
                  >
                    <h4 style={{ 
                      fontSize: tokens.typography.fontSize.md,
                      fontWeight: tokens.typography.fontWeight.semibold,
                      marginBottom: tokens.spacing.sm,
                      color: tokens.colors.state[stateKey],
                    }}>
                      {state}
                    </h4>
                    <p style={{ 
                      fontSize: tokens.typography.fontSize.sm,
                      color: tokens.colors.text.secondary,
                      lineHeight: tokens.typography.lineHeight.normal,
                    }}>
                      This is a {state.toLowerCase()} state card example.
                    </p>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

/**
 * Color Swatch Component
 */
function ColorSwatch({ label, color }: { label: string; color: string }) {
  const tokens = useTokens();
  
  return (
    <div style={{
      padding: tokens.spacing.md,
      backgroundColor: tokens.colors.background.primary,
      borderRadius: tokens.radius.md,
      boxShadow: tokens.shadows.sm,
      border: `1px solid ${tokens.colors.border.default}`,
    }}>
      <div
        style={{
          width: '100%',
          height: '80px',
          backgroundColor: color,
          borderRadius: tokens.radius.sm,
          marginBottom: tokens.spacing.sm,
        }}
      />
      <div style={{ 
        fontSize: tokens.typography.fontSize.sm,
        fontWeight: tokens.typography.fontWeight.medium,
        marginBottom: tokens.spacing.xs,
        color: tokens.colors.text.primary,
      }}>
        {label}
      </div>
      <div style={{ 
        fontSize: tokens.typography.fontSize.xs,
        fontFamily: tokens.typography.fontFamily.mono,
        color: tokens.colors.text.disabled,
      }}>
        {color}
      </div>
    </div>
  );
}

/**
 * Wrapper component with provider
 */
function ThemePresetViewer() {
  return (
    <UIProvider provider="mui">
      <ThemePresetViewerContent />
    </UIProvider>
  );
}

/**
 * Storybook Meta Configuration
 */
const meta: Meta<typeof ThemePresetViewer> = {
  title: 'Theme/Presets',
  component: ThemePresetViewer,
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        component: 'Interactive viewer for all official theme presets. Compare themes and their modes side-by-side.',
      },
    },
  },
};

export default meta;
type Story = StoryObj<typeof ThemePresetViewer>;

/**
 * Interactive Preset Viewer
 */
export const PresetViewer: Story = {};

/**
 * All Presets Grid
 * 
 * Shows all presets in a grid layout for quick comparison
 */
export const AllPresetsGrid: Story = {
  render: () => {
    // Content component that uses tokens
    const GridContent = () => {
      const tokens = useTokens();
      const allPresets = themePresetRegistry.getAll();
      
      if (!tokens || !tokens.colors || !tokens.colors.background || !tokens.spacing || !tokens.typography) {
        return <div style={{ padding: '40px', textAlign: 'center' }}>Loading theme tokens...</div>;
      }
      
      return (
        <div style={{ 
          padding: tokens.spacing.xl,
          backgroundColor: tokens.colors.background.primary,
          minHeight: '100vh',
        }}>
          <h1 style={{ 
            fontSize: tokens.typography.fontSize['3xl'],
            fontWeight: tokens.typography.fontWeight.bold,
            marginBottom: tokens.spacing.xl,
            color: tokens.colors.text.primary,
          }}>
            All Theme Presets
          </h1>
          
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', 
            gap: tokens.spacing.lg 
          }}>
            {allPresets.map((preset) => (
              <div
                key={preset.id}
                style={{
                  padding: tokens.spacing.lg,
                  backgroundColor: tokens.colors.background.secondary,
                  borderRadius: tokens.radius.lg,
                  boxShadow: tokens.shadows.md,
                }}
              >
                <h2 style={{ 
                  fontSize: tokens.typography.fontSize.xl,
                  fontWeight: tokens.typography.fontWeight.semibold,
                  marginBottom: tokens.spacing.sm,
                  color: tokens.colors.text.primary,
                }}>
                  {preset.name}
                </h2>
                <p style={{ 
                  fontSize: tokens.typography.fontSize.sm,
                  color: tokens.colors.text.secondary,
                  marginBottom: tokens.spacing.md,
                }}>
                  {preset.description}
                </p>
                <div style={{ 
                  fontSize: tokens.typography.fontSize.xs,
                  color: tokens.colors.text.disabled,
                  marginTop: tokens.spacing.sm,
                }}>
                  Mode: {preset.mode} â€¢ v{preset.version}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    return (
      <UIProvider provider="mui">
        <GridContent />
      </UIProvider>
    );
  },
};
